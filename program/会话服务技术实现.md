# SM4 密码机服务技术实现

> 文档类型：技术实现
> 所属系统：可信物联系统  
> 文档维护：陈灿
> 电子邮件：chencan@bhz.com.cn  
> 控制范围：产品组、开发组
> 文件版本：V0.01

## 1. 产品需求

- 《会话服务产品需求》；

## 2. 运行环境

- Docker;

## 3. 开发环境

- JAVA 8；
- Spring Boot 2；
- log4j2，用于日志实现；
- jna，用于密码机动态链接库的访问；

## 4. 实现要点

## 5. 服务初始化

1. 加载配置文件；

## 6. 接口实现

### 6.1. 获取服务的基本信息

- 测试版本从 0.1 开始；
- 生产版本从 1.0 开始；

### 6.2. 新增会话

#### 6.2.1. 判断会话信息是否存在

1. 请求存储的查询服务，查询 seid 对应的会话信息；
1. 若已存在有效的会话信息，返回错误信息；

#### 6.2.2. 新增会话

- 请求存储服务的更新服务；

#### 6.2.3. 响应

- 若返回结果包含有效的创建时间和有效期，返回成功信息和会话信息；
- 若失败，则返回错误信息；

### 6.3. 删除会话

#### 6.3.1. 判断会话信息是否存在

1. 请求存储的查询服务，查询 seid 对应的会话信息；
1. 若不存在有效的会话信息，返回错误信息；

#### 6.3.2. 新增会话

- 有效期设定为-1；
- 请求存储服务的更新服务；

#### 6.3.3. 响应

- 若返回结果中的有效期为-1，返回成功信息；
- 若失败，则返回错误信息；

### 6.4. 更新会话

#### 6.4.1. 更新会话

- 请求存储服务的更新服务；

#### 6.4.2 响应

- 若返回结果包含有效的创建时间和有效期，返回成功信息和会话信息；
- 若失败，则返回错误信息；

### 6.5. 查询会话

#### 6.5.1. 更新会话

- 请求存储的查询服务，查询 seid 对应的会话信息；

#### 6.5.2 响应

- 若返回结果包含有效的创建时间和有效期，返回成功信息和会话信息；
- 若失败，则返回错误信息；
